<!DOCTYPE html>
<html>
<head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Inter, sans-serif;
      padding: 16px;
      background: #ffffff;
      height: 100%;
      overflow-y: auto;
    }
    
    .header {
      margin-bottom: 16px;
      position: sticky;
      top: 0;
      background: white;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e5e5;
      z-index: 10;
    }
    
    h2 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .subtitle {
      font-size: 12px;
      color: #666;
    }
    
    .selection-info {
      padding: 12px;
      background: #f5f5f5;
      border-radius: 4px;
      margin-bottom: 16px;
      font-size: 12px;
    }
    
    .selection-info strong {
      color: #333;
    }
    
    .current-styles {
      margin-bottom: 16px;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 4px;
      border-left: 3px solid #18a0fb;
    }
    
    .current-styles-title {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    
    .style-item {
      font-size: 11px;
      color: #666;
      margin-bottom: 4px;
    }
    
    .section {
      margin-bottom: 24px;
    }
    
    .section-title {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #666;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }
    
    .token-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .token-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 12px;
    }
    
    .token-item:hover {
      background: #f5f5f5;
      border-color: #18a0fb;
    }
    
    .token-item.color-token {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .color-preview {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      border: 1px solid #e5e5e5;
      flex-shrink: 0;
    }
    
    .token-name {
      flex: 1;
      font-size: 12px;
    }
    
    .token-path {
      font-size: 10px;
      color: #999;
      margin-left: 8px;
    }
    
    .empty-state {
      padding: 24px;
      text-align: center;
      color: #999;
      font-size: 12px;
    }
    
    .button-group {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      position: sticky;
      bottom: 0;
      background: white;
      padding-top: 12px;
      border-top: 1px solid #e5e5e5;
    }
    
    button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    button.secondary {
      background: #f0f0f0;
      color: #333;
    }
    
    button.secondary:hover {
      background: #e0e0e0;
    }
    
    .message {
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 12px;
      font-size: 12px;
    }
    
    .message.success {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .message.error {
      background: #ffebee;
      color: #c62828;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>Token Picker</h2>
    <div class="subtitle">Apply design tokens to selected components</div>
  </div>
  
  <div id="message-container"></div>
  
  <div class="selection-info" id="selection-info">
    Loading tokens...
  </div>
  
  <div id="current-styles-container"></div>
  
  <div class="section">
    <div class="section-title">Colors</div>
    <div class="token-list" id="colors-list">
      <div class="empty-state">Loading tokens...</div>
    </div>
  </div>
  
  <div class="section">
    <div class="section-title">Typography</div>
    <div class="token-list" id="typography-list">
      <div class="empty-state">No typography tokens found</div>
    </div>
  </div>
  
  <div class="section">
    <div class="section-title">Spacing</div>
    <div class="token-list" id="spacing-list">
      <div class="empty-state">No spacing tokens found</div>
    </div>
  </div>
  
  <div class="button-group">
    <button class="secondary" id="cancel">Close</button>
  </div>
  
  <!-- Embedded tokens JSON -->
  <script>
    // Tokens embedded from ld-tokens-first.json
    const EMBEDDED_TOKENS = {"ld":{"primitive":{},"semantic":{"font":{"display":{"large":{"size":{"$type":"number","$value":"{ld.primitive.font.size.700}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.650}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.400}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.700}"}}},"small":{"size":{"$type":"number","$value":"{ld.primitive.font.size.600}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.600}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.400}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.700}"}}}},"heading":{"large":{"size":{"$type":"number","$value":"{ld.primitive.font.size.500}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.500}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.700}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.400}"}}},"medium":{"size":{"$type":"number","$value":"{ld.primitive.font.size.300}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.450}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.700}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.400}"}}},"small":{"size":{"$type":"number","$value":"{ld.primitive.font.size.200}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.350}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.700}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.400}"}}}},"body":{"large":{"size":{"$type":"number","$value":"{ld.primitive.font.size.150}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.300}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.400}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.700}"}}},"medium":{"size":{"$type":"number","$value":"{ld.primitive.font.size.100}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.300}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.400}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.700}"}}},"small":{"size":{"$type":"number","$value":"{ld.primitive.font.size.50}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.250}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.400}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.700}"}}}},"caption":{"size":{"$type":"number","$value":"{ld.primitive.font.size.25}"},"lineHeight":{"$type":"number","$value":"{ld.primitive.font.lineHeight.200}"},"weight":{"default":{"$type":"number","$value":"{ld.primitive.font.weight.400}"},"alt":{"$type":"number","$value":"{ld.primitive.font.weight.700}"}}},"action":{"weight":{"$type":"number","$value":"{ld.primitive.font.weight.700}"}}},"color":{"background":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.gray.5}"},"inverse":{"$type":"color","$value":"{ld.primitive.color.gray.160}"}},"border":{"$type":"color","$value":"{ld.primitive.color.gray.160}","subtle":{"$type":"color","$value":"{ld.primitive.color.gray.130}"},"subtlest":{"$type":"color","$value":"{ld.primitive.color.gray.100}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"inverse":{"$type":"color","$value":"{ld.primitive.color.white}"},"positive":{"$type":"color","$value":"{ld.primitive.color.green.100}"},"warning":{"$type":"color","$value":"{ld.primitive.color.spark.100}"},"negative":{"$type":"color","$value":"{ld.primitive.color.red.100}"},"info":{"$type":"color","$value":"{ld.primitive.color.blue.100}"},"brand":{"$type":"color","$value":"{ld.primitive.color.blue.100}"},"edited":{"$type":"color","$value":"{ld.primitive.color.purple.100}"},"activated":{"$type":"color","$value":"{ld.primitive.color.blue.100}"}},"surface":{"hovered":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"overlay":{"$type":"color","$value":"{ld.primitive.color.white}"},"subtle":{"$type":"color","$value":"{ld.primitive.color.gray.5}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.20}"}},"activated":{"$type":"color","$value":"{ld.primitive.color.blue.5}","hovered":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.blue.20}"}},"brand":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"$type":"color","$value":"{ld.primitive.color.white}"},"text":{"subtle":{"$type":"color","$value":"{ld.primitive.color.gray.130}"},"subtlest":{"$type":"color","$value":"{ld.primitive.color.gray.100}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"onFill":{"$type":"color","$value":"{ld.primitive.color.gray.160}","positive":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.green.130}"}},"negative":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.red.130}"}},"warning":{"$type":"color","$value":"{ld.primitive.color.gray.160}","subtle":{"$type":"color","$value":"{ld.primitive.color.spark.160}"}},"info":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.blue.130}"}},"edited":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.purple.130}"}},"inverse":{"$type":"color","$value":"{ld.primitive.color.white}"},"transparent":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"activated":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.gray.160}","disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"}},"brand":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.blue.110}"},"bold":{"$type":"color","$value":"{ld.primitive.color.white}"}},"accent":{"blue":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.blue.130}"}},"yellow":{"$type":"color","$value":"{ld.primitive.color.gray.160}","subtle":{"$type":"color","$value":"{ld.primitive.color.yellow.160}"}},"spark":{"$type":"color","$value":"{ld.primitive.color.gray.160}","subtle":{"$type":"color","$value":"{ld.primitive.color.spark.160}"}},"green":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.green.130}"}},"red":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.red.130}"}},"purple":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.purple.130}"}},"gray":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.gray.130}"}},"orange":{"$type":"color","$value":"{ld.primitive.color.gray.160}","subtle":{"$type":"color","$value":"{ld.primitive.color.orange.130}"}},"pink":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.pink.130}"}},"cyan":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.cyan.130}"}},"teal":{"$type":"color","$value":"{ld.primitive.color.white}","subtle":{"$type":"color","$value":"{ld.primitive.color.teal.130}"}}}},"inverse":{"$type":"color","$value":"{ld.primitive.color.white}"},"positive":{"$type":"color","$value":"{ld.primitive.color.green.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.green.130}"}},"warning":{"$type":"color","$value":"{ld.primitive.color.spark.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.spark.160}"}},"negative":{"$type":"color","$value":"{ld.primitive.color.red.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.red.130}"}},"info":{"$type":"color","$value":"{ld.primitive.color.blue.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.blue.130}"}},"brand":{"$type":"color","$value":"{ld.primitive.color.blue.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.blue.110}"}},"edited":{"$type":"color","$value":"{ld.primitive.color.purple.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.purple.130}"}},"accent":{"blue":{"$type":"color","$value":"{ld.primitive.color.blue.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.blue.130}"}},"gray":{"$type":"color","$value":"{ld.primitive.color.gray.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.gray.130}"}},"green":{"$type":"color","$value":"{ld.primitive.color.green.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.green.130}"}},"red":{"$type":"color","$value":"{ld.primitive.color.red.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.red.130}"}},"purple":{"$type":"color","$value":"{ld.primitive.color.purple.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.purple.130}"}},"spark":{"$type":"color","$value":"{ld.primitive.color.spark.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.spark.160}"}},"yellow":{"$type":"color","$value":"{ld.primitive.color.yellow.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.yellow.160}"}},"pink":{"$type":"color","$value":"{ld.primitive.color.pink.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.pink.130}"}},"orange":{"$type":"color","$value":"{ld.primitive.color.orange.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.orange.130}"}},"cyan":{"$type":"color","$value":"{ld.primitive.color.cyan.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.cyan.130}"}},"teal":{"$type":"color","$value":"{ld.primitive.color.teal.100}","onFill":{"$type":"color","$value":"{ld.primitive.color.teal.130}"}}},"activated":{"$type":"color","$value":"{ld.primitive.color.blue.110}"},"$type":"color","$value":"{ld.primitive.color.gray.160}"},"fill":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"},"activated":{"hovered":{"$type":"color","$value":"{ld.primitive.color.blue.110}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.110}"},"$type":"color","$value":"{ld.primitive.color.blue.100}","pressed":{"$type":"color","$value":"{ld.primitive.color.blue.130}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"subtle":{"$type":"color","$value":"{ld.primitive.color.blue.5}","hovered":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.blue.20}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.20}"}}},"inverse":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"subtle":{"$type":"color","$value":"{ld.primitive.color.gray.5}"},"transparent":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}"},"brand":{"$type":"color","$value":"{ld.primitive.color.blue.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"bold":{"$type":"color","$value":"{ld.primitive.color.blue.160}"}},"edited":{"$type":"color","$value":"{ld.primitive.color.purple.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.purple.10}"}},"info":{"$type":"color","$value":"{ld.primitive.color.blue.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.blue.10}"}},"negative":{"$type":"color","$value":"{ld.primitive.color.red.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.red.10}"}},"positive":{"$type":"color","$value":"{ld.primitive.color.green.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.green.10}"}},"warning":{"$type":"color","$value":"{ld.primitive.color.spark.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.spark.10}"}},"accent":{"blue":{"$type":"color","$value":"{ld.primitive.color.blue.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.blue.10}"}},"spark":{"$type":"color","$value":"{ld.primitive.color.spark.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.spark.10}"}},"yellow":{"$type":"color","$value":"{ld.primitive.color.yellow.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.yellow.10}"}},"green":{"$type":"color","$value":"{ld.primitive.color.green.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.green.10}"}},"red":{"$type":"color","$value":"{ld.primitive.color.red.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.red.10}"}},"purple":{"$type":"color","$value":"{ld.primitive.color.purple.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.purple.10}"}},"gray":{"$type":"color","$value":"{ld.primitive.color.gray.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.gray.10}"}},"orange":{"$type":"color","$value":"{ld.primitive.color.orange.70}","subtle":{"$type":"color","$value":"{ld.primitive.color.orange.10}"}},"pink":{"$type":"color","$value":"{ld.primitive.color.pink.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.pink.10}"}},"cyan":{"$type":"color","$value":"{ld.primitive.color.cyan.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.cyan.10}"}},"teal":{"$type":"color","$value":"{ld.primitive.color.teal.100}","subtle":{"$type":"color","$value":"{ld.primitive.color.teal.10}"}}}},"action":{"fill":{"primary":{"$type":"color","$value":"{ld.primitive.color.blue.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.blue.110}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.110}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.blue.130}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}},"secondary":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"}},"tertiary":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"}},"transparent":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}","hovered":{"$type":"color","$value":"{ld.primitive.color.transparentDark.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.transparentDark.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.transparentDark.20}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}"}},"negative":{"$type":"color","$value":"{ld.primitive.color.red.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.red.110}"},"focused":{"$type":"color","$value":"{ld.primitive.color.red.110}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.red.130}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}},"text":{"onFill":{"primary":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.white}"},"focused":{"$type":"color","$value":"{ld.primitive.color.white}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.white}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"}},"secondary":{"$type":"color","$value":"{ld.primitive.color.gray.160}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}},"tertiary":{"$type":"color","$value":"{ld.primitive.color.gray.160}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}},"negative":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.white}"},"focused":{"$type":"color","$value":"{ld.primitive.color.white}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.white}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"}},"transparent":{"$type":"color","$value":"{ld.primitive.color.gray.160}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}}},"border":{"secondary":{"$type":"color","$value":"{ld.primitive.color.gray.160}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}},"tertiary":{"$type":"color","$value":"{ld.primitive.color.gray.50}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}},"transparent":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}","hovered":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}"},"focused":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}"}}}},"link":{"text":{"hovered":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"$type":"color","$value":"{ld.primitive.color.gray.160}","focused":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.180}"},"subtle":{"$type":"color","$value":"{ld.primitive.color.gray.130}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.130}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.130}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.150}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}},"accent":{"white":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.white}"},"focused":{"$type":"color","$value":"{ld.primitive.color.white}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}},"field":{"fill":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.white}"},"focused":{"$type":"color","$value":"{ld.primitive.color.white}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"},"negative":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.white}"},"focused":{"$type":"color","$value":"{ld.primitive.color.white}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"}}},"border":{"$type":"color","$value":"{ld.primitive.color.gray.80}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"negative":{"$type":"color","$value":"{ld.primitive.color.red.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.red.100}"},"focused":{"$type":"color","$value":"{ld.primitive.color.red.100}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}},"text":{"onFill":{"$type":"color","$value":"{ld.primitive.color.gray.160}","disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}},"subtle":{"onFill":{"$type":"color","$value":"{ld.primitive.color.gray.130}","disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}}}},"loading":{"subtle":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"subtlest":{"$type":"color","$value":"{ld.primitive.color.gray.5}"},"$type":"color","$value":"{ld.primitive.color.gray.100}","white":{"$type":"color","$value":"{ld.primitive.color.white}"}},"topNav":{"fill":{"$type":"color","$value":"{ld.primitive.color.blue.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.transparentDark.60}"},"focused":{"$type":"color","$value":"{ld.primitive.color.transparentDark.60}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.transparentDark.80}"}},"text":{"onFill":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.white}"},"focused":{"$type":"color","$value":"{ld.primitive.color.white}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.white}"}}},"separator":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}"}},"pageNav":{"fill":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.blue.5}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.5}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"activated":{"hovered":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.10}"},"$type":"color","$value":"{ld.primitive.color.blue.5}","pressed":{"$type":"color","$value":"{ld.primitive.color.blue.20}"}}},"indicator":{"$type":"color","$value":"{ld.primitive.color.transparentDark.0}","hovered":{"$type":"color","$value":"{ld.primitive.color.blue.20}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.20}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.blue.30}"},"activated":{"$type":"color","$value":"{ld.primitive.color.blue.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.blue.100}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.100}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.blue.100}"}}},"text":{"onFill":{"$type":"color","$value":"{ld.primitive.color.gray.160}","activated":{"$type":"color","$value":"{ld.primitive.color.gray.160}"}}}},"bottomNav":{"fill":{"$type":"color","$value":"{ld.primitive.color.white}","activated":{"$type":"color","$value":"{ld.primitive.color.white}"}},"text":{"onFill":{"$type":"color","$value":"{ld.primitive.color.gray.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.100}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.100}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.100}"},"activated":{"$type":"color","$value":"{ld.primitive.color.blue.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.blue.100}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.100}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.blue.100}"}}}},"separator":{"$type":"color","$value":"{ld.primitive.color.gray.20}"}},"notice":{"fill":{"info":{"$type":"color","$value":"{ld.primitive.color.blue.100}"},"positive":{"$type":"color","$value":"{ld.primitive.color.green.100}"},"warning":{"$type":"color","$value":"{ld.primitive.color.spark.100}"},"negative":{"$type":"color","$value":"{ld.primitive.color.red.100}"}},"text":{"onFill":{"info":{"$type":"color","$value":"{ld.primitive.color.white}"},"positive":{"$type":"color","$value":"{ld.primitive.color.white}"},"warning":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"negative":{"$type":"color","$value":"{ld.primitive.color.white}"}}}},"input":{"fill":{"$type":"color","$value":"{ld.primitive.color.white}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.10}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.white}"},"activated":{"$type":"color","$value":"{ld.primitive.color.gray.160}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.150}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.150}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.140}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}},"border":{"$type":"color","$value":"{ld.primitive.color.gray.160}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"activated":{"hovered":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"},"$type":"color","$value":"{ld.primitive.color.gray.160}"}},"text":{"onFill":{"$type":"color","$value":"{ld.primitive.color.gray.160}","disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}},"indicator":{"activated":{"$type":"color","$value":"{ld.primitive.color.white}"}}},"rating":{"fill":{"$type":"color","$value":"{ld.primitive.color.spark.100}"},"border":{"$type":"color","$value":"{ld.primitive.color.spark.120}"}},"switch":{"fill":{"$type":"color","$value":"{ld.primitive.color.gray.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.gray.130}"},"focused":{"$type":"color","$value":"{ld.primitive.color.gray.130}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.gray.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"activated":{"$type":"color","$value":"{ld.primitive.color.blue.100}","hovered":{"$type":"color","$value":"{ld.primitive.color.blue.130}"},"focused":{"$type":"color","$value":"{ld.primitive.color.blue.130}"},"pressed":{"$type":"color","$value":"{ld.primitive.color.blue.160}"},"disabled":{"$type":"color","$value":"{ld.primitive.color.gray.20}"}}},"indicator":{"$type":"color","$value":"{ld.primitive.color.white}","disabled":{"$type":"color","$value":"{ld.primitive.color.gray.50}"}}},"progress":{"fill":{"$type":"color","$value":"{ld.primitive.color.gray.80}","subtle":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"info":{"$type":"color","$value":"{ld.primitive.color.blue.100}"},"positive":{"$type":"color","$value":"{ld.primitive.color.green.100}"},"warning":{"$type":"color","$value":"{ld.primitive.color.spark.130}"},"negative":{"$type":"color","$value":"{ld.primitive.color.red.100}"}}},"separator":{"$type":"color","$value":"{ld.primitive.color.gray.20}"},"scrim":{"$type":"color","$value":"{ld.primitive.color.transparentDark.60}"},"chart":{"categorical":{"1":{"$type":"color","$value":"{ld.primitive.color.blue.130}"},"2":{"$type":"color","$value":"{ld.primitive.color.pink.70}"},"3":{"$type":"color","$value":"{ld.primitive.color.spark.120}"},"4":{"$type":"color","$value":"{ld.primitive.color.cyan.80}"},"5":{"$type":"color","$value":"{ld.primitive.color.orange.130}"},"6":{"$type":"color","$value":"{ld.primitive.color.purple.60}"},"7":{"$type":"color","$value":"{ld.primitive.color.green.90}"},"8":{"$type":"color","$value":"{ld.primitive.color.pink.120}"}}}},"scale":{"borderWidth":{"interactive":{"$type":"number","$value":"{ld.primitive.scale.borderWidth.100}","hovered":{"$type":"number","$value":"{ld.primitive.scale.borderWidth.200}"},"focused":{"$type":"number","$value":"{ld.primitive.scale.borderWidth.200}"},"pressed":{"$type":"number","$value":"{ld.primitive.scale.borderWidth.200}"},"activated":{"$type":"number","$value":"{ld.primitive.scale.borderWidth.200}","hovered":{"$type":"number","$value":"{ld.primitive.scale.borderWidth.200}"},"focused":{"$type":"number","$value":"{ld.primitive.scale.borderWidth.200}"},"pressed":{"$type":"number","$value":"{ld.primitive.scale.borderWidth.200}"}}}},"icon":{"small":{"$type":"number","$value":"{ld.primitive.scale.space.200}"},"medium":{"$type":"number","$value":"{ld.primitive.scale.space.300}"},"large":{"$type":"number","$value":"{ld.primitive.scale.space.400}"}},"pictogram":{"small":{"$type":"number","$value":"{ld.primitive.scale.space.600}"},"medium":{"$type":"number","$value":"{ld.primitive.scale.space.700}"},"large":{"$type":"number","$value":"{ld.primitive.scale.space.800}"},"xLarge":{"$type":"number","$value":"{ld.primitive.scale.space.900}"}}}}}};
  </script>
  
  <script>
    let currentTokens = { colors: [], spacing: [], typography: [], effects: [] };
    let currentSelection = [];
    let currentStyles = null;
    let tokensData = null;
    
    // Load embedded tokens
    function loadTokens() {
      try {
        tokensData = EMBEDDED_TOKENS;
        
        // Send tokens to plugin code
        parent.postMessage({ 
          pluginMessage: { 
            type: 'tokens-loaded',
            tokens: tokensData
          } 
        }, '*');
      } catch (error) {
        console.error('Error loading tokens:', error);
        document.getElementById('selection-info').innerHTML = 
          '<strong>Error loading tokens</strong><br>Tokens could not be loaded';
      }
    }
    
    // Load tokens on page load
    loadTokens();
    
    // Helper to convert RGB to hex
    function rgbToHex(r, g, b) {
      return "#" + [r, g, b].map(x => {
        const hex = Math.round(x * 255).toString(16);
        return hex.length === 1 ? "0" + hex : hex;
      }).join("");
    }
    
    // Get color from paint
    function getColorFromPaint(paint) {
      if (paint.type === 'SOLID') {
        return rgbToHex(paint.color.r, paint.color.g, paint.color.b);
      }
      return '#ccc';
    }
    
    // Update selection info
    function updateSelectionInfo(selection) {
      const info = document.getElementById('selection-info');
      if (selection.length === 0) {
        info.innerHTML = '<strong>No selection</strong><br>Select a component, frame, or text node to apply tokens';
      } else {
        const types = selection.map(s => s.type.toLowerCase()).join(', ');
        info.innerHTML = `<strong>${selection.length} ${selection.length === 1 ? 'item' : 'items'} selected</strong><br>Type: ${types}`;
      }
    }
    
    // Render a compact token picker for a property
    function renderTokenPicker(tokens, property, nodeIndex, styleProperty) {
      if (!tokens || tokens.length === 0) return '';
      
      const uniqueId = `token-picker-${nodeIndex}-${property}-${Date.now()}-${Math.random()}`;
      let html = `<div style="margin-left: 16px; margin-top: 4px; margin-bottom: 8px;">`;
      html += `<select class="token-select" data-property="${property}" data-node-index="${nodeIndex}" style="width: 100%; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 11px; background: white;">`;
      html += `<option value="">Choose token...</option>`;
      
      tokens.forEach(token => {
        const shortPath = token.path.split('.').slice(-3).join('.');
        const displayValue = token.value !== undefined ? (typeof token.value === 'number' ? `${token.value}px` : token.value) : '';
        html += `<option value="${token.path}">${token.name} (${shortPath}) ${displayValue ? `- ${displayValue}` : ''}</option>`;
      });
      
      html += `</select></div>`;
      
      return html;
    }
    
    // Attach event listeners to token pickers using event delegation
    function attachTokenPickerListeners(container) {
      container.addEventListener('change', (e) => {
        if (e.target.classList.contains('token-select')) {
          const tokenPath = e.target.value;
          const property = e.target.getAttribute('data-property');
          if (tokenPath && property) {
            const tokenType = property === 'fill' || property === 'stroke' ? 'color' : '';
            parent.postMessage({ 
              pluginMessage: { 
                type: 'apply-token', 
                tokenPath, 
                tokenType,
                property: property
              } 
            }, '*');
          }
        }
      });
    }
    
    // Render styles for a single node with inline token pickers
    function renderNodeStyles(nodeName, nodeType, styles, tokens, nodeIndex) {
      let html = '';
      
      if (styles.fills && styles.fills.length > 0) {
        const color = getColorFromPaint(styles.fills[0]);
        html += `<div class="style-item" style="margin-bottom: 4px;">Fill: <span style="display:inline-block;width:12px;height:12px;background:${color};border:1px solid #ccc;vertical-align:middle;margin:0 4px;"></span>${color}</div>`;
        html += renderTokenPicker(tokens.colors, 'fill', nodeIndex, 'fills');
      }
      
      if (styles.strokes && styles.strokes.length > 0) {
        const strokeColor = getColorFromPaint(styles.strokes[0]);
        html += `<div class="style-item" style="margin-bottom: 4px;">Stroke: <span style="display:inline-block;width:12px;height:12px;background:${strokeColor};border:1px solid #ccc;vertical-align:middle;margin:0 4px;"></span>${strokeColor}</div>`;
        html += renderTokenPicker(tokens.colors, 'stroke', nodeIndex, 'strokes');
      }
      
      if (styles.fontSize) {
        html += `<div class="style-item" style="margin-bottom: 4px;">Font Size: ${styles.fontSize}px</div>`;
        const fontSizeTokens = tokens.typography ? tokens.typography.filter(t => t.path.includes('size')) : [];
        html += renderTokenPicker(fontSizeTokens, 'fontSize', nodeIndex, 'fontSize');
      }
      
      if (styles.fontWeight) {
        html += `<div class="style-item" style="margin-bottom: 4px;">Font Weight: ${styles.fontWeight}</div>`;
        // Note: fontWeight is read-only, but we can still show tokens for reference
      }
      
      if (styles.fontName) {
        const fontName = typeof styles.fontName === 'object' ? `${styles.fontName.family} ${styles.fontName.style || ''}`.trim() : styles.fontName;
        html += `<div class="style-item" style="margin-bottom: 4px;">Font: ${fontName}</div>`;
      }
      
      if (styles.lineHeight) {
        const lh = styles.lineHeight;
        const lhValue = typeof lh === 'object' ? lh.value : lh;
        html += `<div class="style-item" style="margin-bottom: 4px;">Line Height: ${lhValue}${typeof lh === 'object' && lh.unit === 'PIXELS' ? 'px' : ''}</div>`;
        const lineHeightTokens = tokens.typography ? tokens.typography.filter(t => t.path.includes('lineHeight')) : [];
        html += renderTokenPicker(lineHeightTokens, 'lineHeight', nodeIndex, 'lineHeight');
      }
      
      if (styles.letterSpacing) {
        const ls = styles.letterSpacing;
        const lsValue = typeof ls === 'object' ? ls.value : ls;
        html += `<div class="style-item" style="margin-bottom: 4px;">Letter Spacing: ${lsValue}${typeof ls === 'object' && ls.unit === 'PIXELS' ? 'px' : ''}</div>`;
      }
      
      if (styles.cornerRadius !== undefined) {
        html += `<div class="style-item" style="margin-bottom: 4px;">Corner Radius: ${styles.cornerRadius}px</div>`;
        html += renderTokenPicker(tokens.borderRadius, 'cornerRadius', nodeIndex, 'cornerRadius');
      }
      
      if (styles.paddingLeft !== undefined || styles.paddingTop !== undefined) {
        const padding = styles.paddingTop || styles.paddingLeft || 0;
        html += `<div class="style-item" style="margin-bottom: 4px;">Padding: ${padding}px</div>`;
        html += renderTokenPicker(tokens.spacing, 'spacing', nodeIndex, 'padding');
      }
      
      if (styles.effects && styles.effects.length > 0) {
        const effectCount = styles.effects.length;
        html += `<div class="style-item" style="margin-bottom: 4px;">Effects: ${effectCount} ${effectCount === 1 ? 'effect' : 'effects'}</div>`;
      }
      
      return html;
    }
    
    // Update current styles display - shows all styles from all nodes with inline token pickers
    function updateCurrentStyles(styles, allStyles, tokens) {
      const container = document.getElementById('current-styles-container');
      
      // Use allStyles if available, otherwise fall back to single styles object
      if (allStyles && allStyles.length > 0) {
        let html = '<div class="current-styles"><div class="current-styles-title">Current Styles (All Nodes)</div>';
        
        allStyles.forEach((nodeData, index) => {
          const nodeStylesHtml = renderNodeStyles(nodeData.nodeName, nodeData.nodeType, nodeData.styles, tokens || {}, index);
          if (nodeStylesHtml) {
            html += `<div style="margin-top: ${index > 0 ? '12px' : '0'}; padding-top: ${index > 0 ? '12px' : '0'}; border-top: ${index > 0 ? '1px solid #e5e5e5' : 'none'};">`;
            html += `<div style="font-weight: 600; font-size: 11px; color: #666; margin-bottom: 6px;">${nodeData.nodeName} (${nodeData.nodeType})</div>`;
            html += nodeStylesHtml;
            html += '</div>';
          }
        });
        
        html += '</div>';
        container.innerHTML = html;
        // Attach event listeners using event delegation
        attachTokenPickerListeners(container);
      } else if (styles) {
        // Fallback to single styles object for backward compatibility
        let html = '<div class="current-styles"><div class="current-styles-title">Current Styles</div>';
        html += renderNodeStyles('Selected Node', 'NODE', styles, tokens || {}, 0);
        html += '</div>';
        container.innerHTML = html;
        // Attach event listeners using event delegation
        attachTokenPickerListeners(container);
      } else {
        container.innerHTML = '';
      }
    }
    
    // Render color tokens
    function renderColorTokens(colors) {
      const container = document.getElementById('colors-list');
      if (colors.length === 0) {
        container.innerHTML = '<div class="empty-state">No color tokens found</div>';
        return;
      }
      
      container.innerHTML = colors.map(token => {
        const color = token.value || '#ccc';
        const shortPath = token.path.split('.').slice(-3).join('.');
        return `
          <div class="token-item color-token" data-token-path="${token.path}" data-token-type="color">
            <div class="color-preview" style="background: ${color}"></div>
            <div class="token-name">${token.name}</div>
            <div class="token-path">${shortPath}</div>
          </div>
        `;
      }).join('');
      
      container.querySelectorAll('.token-item').forEach(item => {
        item.addEventListener('click', () => {
          const tokenPath = item.getAttribute('data-token-path');
          const tokenType = item.getAttribute('data-token-type');
          parent.postMessage({ 
            pluginMessage: { 
              type: 'apply-token', 
              tokenPath, 
              tokenType,
              property: 'fill'
            } 
          }, '*');
        });
      });
    }
    
    // Render typography tokens
    function renderTypographyTokens(typography) {
      const container = document.getElementById('typography-list');
      if (typography.length === 0) {
        container.innerHTML = '<div class="empty-state">No typography tokens found</div>';
        return;
      }
      
      const fontSize = typography.filter(t => t.path.includes('size'));
      const lineHeight = typography.filter(t => t.path.includes('lineHeight'));
      const fontWeight = typography.filter(t => t.path.includes('weight'));
      
      let html = '';
      
      if (fontSize.length > 0) {
        html += '<div style="margin-bottom: 8px;"><strong style="font-size: 11px; color: #666;">Font Size</strong>';
        html += fontSize.map(token => {
          const shortPath = token.path.split('.').slice(-3).join('.');
          return `
            <div class="token-item" data-token-path="${token.path}" data-property="fontSize" style="margin-top: 4px;">
              <div class="token-name">${token.name}: ${token.value}px</div>
              <div class="token-path">${shortPath}</div>
            </div>
          `;
        }).join('');
        html += '</div>';
      }
      
      if (lineHeight.length > 0) {
        html += '<div style="margin-bottom: 8px;"><strong style="font-size: 11px; color: #666;">Line Height</strong>';
        html += lineHeight.map(token => {
          const shortPath = token.path.split('.').slice(-3).join('.');
          return `
            <div class="token-item" data-token-path="${token.path}" data-property="lineHeight" style="margin-top: 4px;">
              <div class="token-name">${token.name}: ${token.value}</div>
              <div class="token-path">${shortPath}</div>
            </div>
          `;
        }).join('');
        html += '</div>';
      }
      
      if (fontWeight.length > 0) {
        html += '<div><strong style="font-size: 11px; color: #666;">Font Weight</strong>';
        html += fontWeight.map(token => {
          const shortPath = token.path.split('.').slice(-3).join('.');
          return `
            <div class="token-item" data-token-path="${token.path}" data-property="fontWeight" style="margin-top: 4px;">
              <div class="token-name">${token.name}: ${token.value}</div>
              <div class="token-path">${shortPath}</div>
            </div>
          `;
        }).join('');
        html += '</div>';
      }
      
      container.innerHTML = html;
      
      container.querySelectorAll('.token-item').forEach(item => {
        item.addEventListener('click', () => {
          const tokenPath = item.getAttribute('data-token-path');
          const property = item.getAttribute('data-property');
          parent.postMessage({ 
            pluginMessage: { 
              type: 'apply-token', 
              tokenPath,
              property
            } 
          }, '*');
        });
      });
    }
    
    // Render spacing tokens
    function renderSpacingTokens(spacing) {
      const container = document.getElementById('spacing-list');
      if (spacing.length === 0) {
        container.innerHTML = '<div class="empty-state">No spacing tokens found</div>';
        return;
      }
      
      container.innerHTML = spacing.map(token => {
        const shortPath = token.path.split('.').slice(-3).join('.');
        return `
          <div class="token-item" data-token-path="${token.path}" data-property="spacing">
            <div class="token-name">${token.name}: ${token.value}px</div>
            <div class="token-path">${shortPath}</div>
          </div>
        `;
      }).join('');
      
      container.querySelectorAll('.token-item').forEach(item => {
        item.addEventListener('click', () => {
          const tokenPath = item.getAttribute('data-token-path');
          parent.postMessage({ 
            pluginMessage: { 
              type: 'apply-token', 
              tokenPath,
              property: 'spacing'
            } 
          }, '*');
        });
      });
    }
    
    // Show message
    function showMessage(text, type) {
      const container = document.getElementById('message-container');
      container.innerHTML = `<div class="message ${type}">${text}</div>`;
      setTimeout(() => {
        container.innerHTML = '';
      }, 3000);
    }
    
    // Listen for messages from plugin
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      
      if (msg.type === 'init') {
        currentTokens = msg.tokens;
        currentSelection = msg.selection;
        currentStyles = msg.currentStyles;
        // Hide old token sections since we're showing them inline now
        document.getElementById('colors-list').style.display = 'none';
        document.getElementById('typography-list').style.display = 'none';
        document.getElementById('spacing-list').style.display = 'none';
        document.querySelectorAll('.section').forEach(section => {
          section.style.display = 'none';
        });
        updateSelectionInfo(msg.selection);
        updateCurrentStyles(msg.currentStyles, msg.allStyles, msg.tokens);
      }
      
      if (msg.type === 'selection-changed') {
        currentSelection = msg.selection;
        currentStyles = msg.currentStyles;
        currentTokens = msg.tokens;
        updateSelectionInfo(msg.selection);
        updateCurrentStyles(msg.currentStyles, msg.allStyles, msg.tokens);
      }
      
      if (msg.type === 'success') {
        showMessage(msg.message, 'success');
      }
      
      if (msg.type === 'error') {
        showMessage(msg.message, 'error');
      }
    };
    
    // Button handlers
    document.getElementById('cancel').onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
    };
  </script>
</body>
</html>
